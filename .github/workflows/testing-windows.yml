name: Windows Testing
on:
  workflow_dispatch:

env:
  GO_VERSION: "1.21"

jobs:

  test:
    name: Run Tests
    needs:
      - go-generate
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [windows-2022]
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          show-progress: false

      - name: Install go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}

      # avoid needing to download packages during test runs
      - name: Pre-fill Module Cache
        run: go mod download -x

      - name: Test repo
        shell: pwsh
        run: |
          GIPC_TIMEOUT=5 GIPC_WAIT=2500 make test